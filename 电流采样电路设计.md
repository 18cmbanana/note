# 电流采样电路设计
 ## 引言
 由于电机的宽范围调速以及高速特性，加上电机自身不能获得理想的正弦气隙磁场，导致在系统控制时采样的相电流含有不规则的高次谐波和随机干扰，再加上电流采样电路的不稳定性和A/D转换单元偏差的存在，更是加大了实际采样到的电流误差。
 众所周知，电流的采样对电机矢量控制是非常重要的。电流采样方式主要有3种。
 表1.1 电流采样方式
 ![image.png](https://s2.loli.net/2022/03/01/PW1KgMN43SyaUf6.png)



 ## 抗干扰设计
 1. 采样电阻
 采样电阻是基本的电阻元器件，同时其参数的选择对采样精确度也是重要的影响因素。
 电机控制器对电机的其中两相电流通过采样电阻进行采样，如图1所示，从采样电阻上获取的电压信号经过电压偏置和放大，输入到微处理器的A/D单元，从而得到其中两相电流，再根据基尔霍夫定律，三相电流矢量和为0，推算出第三相的电流的值。
 对于320V供电空调压缩机，电机内阻0.2Ω，如果采样电阻合适，则对回路没有什么影响。如果采样电阻的阻值过大，会引起电压的损耗，使能量效率变低，较大的阻值会使负载电压发生偏移，产生电磁干扰，产生系统对噪声敏感的问题。当确定好阻值后还需要考虑电阻的稳定性能和阻值误差。
 2. 运放设计
运放芯片本身对共模干扰有抵抗作用，而在差模干扰的抵抗作用稍弱，所以设计的时候要着重提高差分线上的差模抗干扰能力。如图2所示，C2电容就是为了提高抗差模干扰能力。差分线上的电阻（R34、R35）和反馈电阻（R39）应使用高精度的电阻，使得理论计算得到的参数是准确可靠的。然后与运放的输出连接的AD口引脚上并连一个RC电路滤掉高次谐波干扰和随机脉冲干扰，从而提升抗干扰能力。
![image.png](https://s2.loli.net/2022/03/01/2OMDxr67WBzqntU.png)
 3. PCB布置
 为了能够准确的采样电流，应将运放芯片在PCB上的位置尽量靠近采样电阻，同时又要使运放芯片不能远离MCU，运放的地和MCU的地应该尽量靠拢。如图3所示，采样电阻（R98、R99、R100）两端走差分线到运放的同相和反相端口，差分线应等距并且尽量短，以避免其他的干扰产生。压缩机涉及到高压和低压部分，在布局电流地的时候，应使大电流地和小电流地能很好的单点隔离。
 ![image.png](https://s2.loli.net/2022/03/01/aBDOHvs9U7itxhe.png)

 图3运放差分走线
 以上经过硬件滤波后，如图4所示，3相电流波形得到显著的优化。
 ![image.png](https://s2.loli.net/2022/03/01/5eqiaclHuA8NLZk.png)